name: My Workflow

on:
  push:
  pull_request:

jobs:
  my_job:
    runs-on: ubuntu-latest
    steps:
      - name: Step 1
        run: echo "Step 1"

      - name: Step 2
        run: exit 1

      - name: Manual Intervention Approval
        id: manual_step
        if: ${{ failure() }}
        uses: actions/github-script@v5
        with:
          script: |
            // Check if it's a pull request event
            if (context.payload.pull_request) {
              const response = await github.rest.pulls.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: 'Manual Intervention Required',
                head: context.sha,
                base: context.payload.pull_request.base.ref
              });
              core.setOutput('pullRequestUrl', response.data.html_url);
            } else {
              core.setOutput('pullRequestUrl', '');
            }

      - name: Resume Step
        if: steps.manual_step.conclusion == 'success' || steps.manual_intervention_approval.outputs.pullRequestUrl
        run: echo "Resuming from manual intervention"

      - name: Automatic Step
        if: steps.manual_step.conclusion == 'failure' && !steps.manual_intervention_approval.outputs.pullRequestUrl
        run: echo "This step will run automatically when manual intervention is not required"
